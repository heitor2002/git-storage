import { Layout } from "@/components/Layout";
import registerValidation from "@/lib/user";
import Head from "next/head";
import Link from "next/link";
import { useState } from "react";
import { v4 as uuidv4 } from "uuid";

export default function Register() {
  const [user, setUser] = useState({
    username: "",
    email: "",
    confirmEmail: "",
    password: "",
    confirmPassword: "",
    userKey: uuidv4(),
    privateKey: uuidv4(),
  });

  const [errorMessage, setErrorMessage] = useState("");
  const [colorMessage, setColorMessage] = useState("#eb4034") //Mensagem de erro

  const onChangeInput = (e) =>
    setUser({ ...user, [e.target.name]: e.target.value });

  const handleSubmit = async (e) => {
    e.preventDefault()
    const validate = await registerValidation(user)
    setErrorMessage(validate)

    //SETANDO COR DA MENSAGEM
    if(validate === "Cadastrando..."){
      setColorMessage("#2bbd3c")  //Mensagem de sucesso
    }

  };
  return (
    <>
      <Head>
        <title>Página de registro</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <Layout>
        <div className="form-login">
          <form onSubmit={handleSubmit}>
            <input
              type="text"
              placeholder="Usuário github:"
              value={user.username}
              name="username"
              onChange={onChangeInput}
              required
            />
            <input
              type="text"
              placeholder="E-mail:"
              value={user.email}
              name="email"
              onChange={onChangeInput}
              required
            />
            <input
              type="text"
              placeholder="Confirmar e-mail:"
              value={user.confirmEmail}
              name="confirmEmail"
              onChange={onChangeInput}
              required
            />
            <input
              type="password"
              placeholder="Senha:"
              value={user.password}
              name="password"
              onChange={onChangeInput}
              required
            />
            <input
              type="password"
              placeholder="Confirmar senha:"
              value={user.confirmPassword}
              name="confirmPassword"
              onChange={onChangeInput}
              required
            />
            <p>
              Já possui conta? <Link href={"/login"}>Faça seu login aqui!</Link>
            </p>
            {/* {!errorMessage && <p>Mensagem </p>} */}
            <p style={{color: colorMessage}}>{errorMessage}</p>
            <input type="submit" value={"Cadastrar"} />
          </form>
        </div>
      </Layout>
    </>
  );
}
